---
title: "Midterm 1"
output: pdf_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# load all of our libraries that we are going to use

library(stargazer)
library(psych)
library(mediation)
library(janitor)
library(haven)
library(arm)
library(tidyverse)

```

```{r, load data}

# Load Data in, and select only what we need to do our regressions

all_data <- read_dta("dataverse_files/replicationdata.dta") %>% 
  clean_names() %>% 
  select(
    scd_brad_self_report1_mean, 
    scd_brad_vid_manip_all_mean,
    anxcond3,
    anxcond, 
    immigration, 
    storycond)

Might be a good idea to rename these just to keep track of what is what. Not super intuitive names right now.
```

# Abstract

This document is the culmination of the first half of the semester's studies in replicating published journal articles. In this document, I have replicated Table 1, Figure 2, and Figure 3 from the article “Physiological arousal and political beliefs."

Additionally, my main extension is that I have re-run the regressions for Table 1 and figure 3 using a bayesian approach, instead of the frequentist approach used in the paper. 

There are some differences between these two approaches. The Bayesian approach to linear regression returns a distribution for potential values that coefficients can take on, while the frequentist simply gives a point estimate with some estimate for standard error.

This Bayesian approach is helpful: it gives us another route to check the robustness of our model (indeed, the two estimates approach each other as the sample size appraoches infinity) and it allows us to inform the model about the expected value of each of the coefficients through a prior distribution. 

Ultimately, the regressions run both ways reveal that the model is still robust: the coefficients in the two estimates (before and after mediation) are still significant, and are very close to one another. 

Nice abstract. Very clear to the reader what you will be doing throughout the report.

\newpage

# Table 1

```{r table 1, results='asis'}

# select only the neutral and anxiety conditions

noRelaxCond <- filter(all_data, anxcond3 > 0)

# (1) perform frequentist linear regression on the conductance value
# while filling out the report, using the type of video used. 
# note that this is done after eliminating the neutral data

m <- lm( data = noRelaxCond, formula = scd_brad_self_report1_mean ~ anxcond) 

# (2) perform frequentist linear regression on the feelings towards 
# immigrants (scored using some combination of the data), using 
# the type of immigration story used, the type of video used, and 
# the conductance levels while filling out the report
# note that this is done after eliminating the neutral data

Great comments! Useful for you when you come back to this or others who try to replicate.

y <- lm( data = noRelaxCond, immigration ~ storycond + anxcond + scd_brad_self_report1_mean) 

# throw this into a table

stargazer(m, y, header = FALSE,
          omit.stat = c("f","ser"), 
          covariate.labels = c("Story Condition",
                               "Anxiety Manipulation",
                               "Skin Conductance Reactivity when answering questions",
                               "Constant"),
          dep.var.labels = c("Skin Conductance Reactivity", "Immigration Preferences"))

```
Good replication of Table 1. It would be nice to see some footnotes or a paragraph explaining what's going on here and why it matters.
This helps orient the reader so they are prepared to digest your extension.

\newpage

# Figure 2

Means of skin-conductance reactivity by video condition. 95% confidence intervals are show surrounding the mean.



```{r, figure 2}

# figure 2

# select only the data that is the type of video watched and the 
# value of the skin conductance, and make sure that they are all
# useable values (no NAs)

dta_small <- select(all_data, scd_brad_vid_manip_all_mean, anxcond3) %>%
  filter(!is.na(anxcond3), !is.na(scd_brad_vid_manip_all_mean)) %>% 
  mutate(anxcond3_str = ifelse(anxcond3 == 0, "Relax", ifelse(anxcond3 == 1, "Neutral", "Anxiety")))

# plot these, with error bars (that is what mean_se is for)
# look here for more direction:
# https://stackoverflow.com/questions/38599335/
# how-to-add-standard-error-bars-to-a-box-and-whisker-plot-using-ggplot2
# but place the link all on one line

ggplot(dta_small, aes(x = anxcond3_str, y = scd_brad_vid_manip_all_mean)) + 
  theme_minimal() +
  stat_summary(fun.y=mean, geom="point", size=2) + 
  stat_summary(fun.data = mean_se, geom = "errorbar") + 
  labs(x = "Anxiety Condition Treated", y = "Skin Conductance Reactivity while watching video" ) 



```

These confidence intervals aren't quite right, they are all too narrow. Both neutral and relax should cross 0. It looks
like you didn't divide the SE by sqrt(n) and multiply by 1.96. Other than that, it looks good.



\newpage

# Figure 3. 

Causal mediation plot. Treatment is anxiety video manipulation (compared to neutral condition), Mediator is skin conductance reactivity when answering immigration questions, Outcome is composite variable of immigration preferences.

Horizontal lines represent 90% confidence intervals for estimates.

```{r, figure 3}

# Causal Mediation Plot

# Mediation Analysis

# basically used to measure the actual effect of the treatment, getting rid
# of the mediator variable (in this case, the conductance)

m.out<-mediate(m,y, sims=500, treat="anxcond", mediator="scd_brad_self_report1_mean", dropobs=TRUE, boot=TRUE, conf.level=.90)

plot(m.out, labels=c("ACME\n(Physiological \nReactivity)", "Direct Effect \n(Anxiety)", "Total Effect"), cex.axis = 0.6) 

Perfect replication of Figure 3.

```
Great replication overall. Talking a little more about each figure in the report is recommended.

\newpage

# Table 1, extended

These correspond to the output to calls to a bayesian regression, same as figure 1.


```{r, extension table 1, results = 'asis'}

noRelaxCond <- filter(all_data, anxcond3 > 0)

# re-run the regressions above, but with a bayesian approach instead of a 
# frequentist approach

m_default_prior <- bayesglm( data = noRelaxCond, formula = scd_brad_self_report1_mean ~ anxcond) 

y_default_prior <- bayesglm( data = noRelaxCond, immigration ~ storycond + anxcond + scd_brad_self_report1_mean) 

# display summary results for these two regressions (ideally this would)
# be formatted better

summary(m_default_prior)
summary(y_default_prior)



```
I would recommned just supressing this output if you're not going to put it in a table.

\newpage

This is a graphical representation of the coefficients of the bayesian linear regression.


```{r, plot bayes m}


# throw these into plots

coefplot(m_default_prior)

```

Good use of Bayesian regression, but a reader has to look at this for a bit to figure out what's going on.
Especially since it's labeled anxcond.

\newpage

This is a graphical representation of the coefficients of the bayesian linear regression.

This shows what the coeffecients are, and how large the error bound is on them.

These error bars are actually quite large, however, they are still significant to a similar degree as the previous results. 

```{r, plot bayes y}


# throw these into plots

coefplot(y_default_prior)

```
Good use of coef plot. But definitely needs some intuitive labels and slightly more of an explanation.

\newpage

# Figure 3, extended

Causal mediation plot. Treatment is anxiety video manipulation (compared to neutral condition), Mediator is skin conductance reactivity when answering immigration questions, Outcome is composite variable of immigration preferences.

Horizontal lines represent 90% confidence intervals for estimates.

The extension is that this analysis was performed with bayesian linear regression, instead of frequentist linear regression. Ultimately, the values found her coincide closely with the values computed from the frequentist analysis, and thus demonstrate a robustness of the model.

```{r, extension, figure 3}

# re-run Mediation Analysis, this time with the bayesian regressions

m.out<-mediate(m_default_prior,y_default_prior, sims=500, treat="anxcond", mediator="scd_brad_self_report1_mean", dropobs=TRUE, boot=TRUE, conf.level=.90)

plot(m.out, labels=c("ACME\n(Physiological \nReactivity)", "Direct Effect \n(Anxiety)", "Total Effect"), cex.axis = 0.6) 

```
Good looking extended figure 3. Nice job overall. Consider my comments when moving forward with the final paper.

\newpage

# Bibliography

Hlavac, Marek (2018). stargazer: Well-Formatted Regression and Summary Statistics Tables.
 R package version 5.2.2. https://CRAN.R-project.org/package=stargazer 

Renshon, Jonathan, Jooa Julia Lee, and Dustin Tingley. “Physiological arousal and political beliefs.” Political Psychology36.5 (2015): 569-585.


